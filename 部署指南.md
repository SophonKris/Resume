# Windows Server IIS 部署指南

本指南将帮助您将个人简历网站部署到 Windows Server IIS 服务器上。

## 前提条件

1. Windows Server 操作系统（2012 R2、2016、2019 或 2022）
2. 已安装 IIS（Internet Information Services）
3. 域名已解析到服务器 IP（ai.krisgeek.com）

## 部署步骤

### 1. 准备网站文件

确保您已经完成了网站的本地测试，并且所有功能正常工作。

### 2. 安装 IIS

如果尚未安装 IIS，请按照以下步骤安装：

1. 打开"服务器管理器"
2. 点击"添加角色和功能"
3. 选择"基于角色或基于功能的安装"，点击"下一步"
4. 选择当前服务器，点击"下一步"
5. 在"服务器角色"中，勾选"Web 服务器 (IIS)"
6. 在弹出的窗口中点击"添加功能"，然后点击"下一步"
7. 保持默认设置，一直点击"下一步"直到安装页面
8. 点击"安装"开始安装 IIS

### 3. 创建网站目录

1. 在服务器上创建一个目录用于存放网站文件，例如：`C:\inetpub\wwwroot\resume`
2. 将所有网站文件复制到该目录中

### 4. 在 IIS 中创建网站

1. 打开"Internet Information Services (IIS) 管理器"
2. 在左侧导航栏中，展开服务器名称
3. 右键点击"网站"，选择"添加网站"
4. 填写以下信息：
   - 网站名称：个人简历网站
   - 物理路径：`C:\inetpub\wwwroot\resume`（您创建的目录）
   - 绑定类型：http
   - IP 地址：全部未分配
   - 端口：80
   - 主机名：ai.krisgeek.com
5. 点击"确定"创建网站

### 5. 配置 MIME 类型（如需要）

如果您的网站使用了一些特殊文件类型，可能需要添加 MIME 类型：

1. 在 IIS 管理器中，选择您创建的网站
2. 双击"MIME 类型"图标
3. 在右侧操作面板中，点击"添加"
4. 添加所需的文件扩展名和 MIME 类型
5. 点击"确定"保存

### 6. 配置 web.config 文件

在网站根目录下创建或修改 `web.config` 文件，添加以下内容：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <staticContent>
            <mimeMap fileExtension=".json" mimeType="application/json" />
        </staticContent>
        <defaultDocument>
            <files>
                <clear />
                <add value="index.html" />
            </files>
        </defaultDocument>
        <httpErrors errorMode="Custom" existingResponse="Replace">
            <remove statusCode="404" />
            <error statusCode="404" path="/index.html" responseMode="ExecuteURL" />
        </httpErrors>
    </system.webServer>
</configuration>
```

这个配置文件设置了默认文档为 index.html，并将 404 错误重定向到首页。

### 7. 设置目录权限

确保 IIS 用户对网站目录有读取权限：

1. 右键点击网站目录，选择"属性"
2. 切换到"安全"选项卡
3. 点击"编辑"，然后点击"添加"
4. 输入 `IIS_IUSRS`，点击"检查名称"，然后点击"确定"
5. 为 IIS_IUSRS 用户组授予"读取和执行"、"列出文件夹内容"和"读取"权限
6. 点击"确定"保存设置

### 8. 测试网站

1. 打开浏览器，访问 http://ai.krisgeek.com
2. 确认网站正常加载，并且所有功能正常工作

### 9. 配置 HTTPS（推荐）

为了提高网站安全性，建议配置 HTTPS：

1. 获取 SSL 证书（可以使用 Let's Encrypt 免费证书）
2. 在 IIS 管理器中，选择您的网站
3. 在右侧操作面板中，点击"绑定"
4. 点击"添加"，选择类型为"https"
5. 选择您的 SSL 证书
6. 设置主机名为 ai.krisgeek.com
7. 点击"确定"保存

### 10. 配置 HTTP 重定向到 HTTPS（可选）

1. 在 IIS 管理器中，选择您的网站
2. 双击"HTTP 重定向"图标
3. 勾选"将请求重定向到此目标"
4. 输入 https://ai.krisgeek.com/{R:1}
5. 勾选"仅将此目录中的请求重定向到目标"
6. 选择"状态代码"为"永久 (301)"
7. 点击"应用"保存设置

## 故障排除

### 网站无法访问

1. 检查 IIS 服务是否正在运行
2. 确认防火墙已开放 80 端口（HTTP）和 443 端口（HTTPS）
3. 验证域名是否正确解析到服务器 IP
4. 检查网站绑定配置是否正确

### 文件无法加载

1. 检查文件权限
2. 确认 MIME 类型配置正确
3. 查看 IIS 日志文件，位于 `%SystemDrive%\inetpub\logs\LogFiles`

### 500 内部服务器错误

1. 检查 web.config 文件语法是否正确
2. 查看事件查看器中的应用程序日志
3. 临时启用详细错误信息：在 web.config 中添加以下内容：

```xml
<system.webServer>
    <httpErrors errorMode="Detailed" />
</system.webServer>
<system.web>
    <customErrors mode="Off" />
    <compilation debug="true" />
</system.web>
```

## 维护与更新

当需要更新网站内容时：

1. 备份当前网站文件
2. 上传新文件到网站目录
3. 如果需要，重启 IIS 应用程序池：
   - 在 IIS 管理器中，展开服务器 > 应用程序池
   - 右键点击对应的应用程序池，选择"回收"

## 安全建议

1. 定期更新 Windows Server 和 IIS
2. 使用强密码保护服务器
3. 配置 Windows 防火墙，只开放必要的端口
4. 安装并配置防病毒软件
5. 定期备份网站文件和配置